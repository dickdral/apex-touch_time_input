var apextic={x:null,y:null,hourHand:null,minuteHand:null,activeHand:null,handLength:{hourHand:"60",minuteHand:"85"},clockItem:null,ticId:"ticControl",ticBox:document.getElementById("ticBox"),startx:0,starty:0,dist:0,hourTextLeft:0,window_base:7,time_format:"hh24:mi",logging:0,activeHandName:"hour",currentHour:null,currentMinutes:null,sensitivity:20,mode:"base",touchStartInClock:false,debug:function(a){if(this.logging==1){console.log(a)}},lpad:function(b){var a="";if(b!=null){a=b.toString();if(a.length==1){a="0"+a}}return(a)},getAngleFromVector:function(c,b){var d=0;var a=180/Math.PI;if(c==0){if(b>0){d=180}else{d=0}}else{d=Math.atan(b/Math.abs(c))*a;if(c>0){d=90+d}else{d=270-d}}return(d)},setMode:function(a){this.mode=a;if(this.mode=="AM"){this.window_base=0;$("#buttonPM text").attr("fill","black");$("#buttonAM text").attr("fill","lightgray")}else{this.window_base=12;$("#buttonPM text").attr("fill","lightgray");$("#buttonAM text").attr("fill","black")}},SVG:function(a){return document.createElementNS("http://www.w3.org/2000/svg",a)},setCurrentTimeFromString:function(b){var a=b.split(":");if(a.length>=1){this.currentHour=parseInt(a[0]);if(this.currentHour>=12){this.setMode("PM")}else{this.setMode("AM")}}if(a.length>=2){this.currentMinutes=parseInt(a[1])}},getTime:function(c,b){var d,a;if(Math.abs(b)>Math.abs(c)){a=c/b;if(b>0){d=11}else{d=5}}else{a=-b/c;if(c>0){d=2}else{d=8}}if(a>-0.26){d+=1}if(a>0.26){d+=1}if(d>=12){d-=12}return(d)},getActiveHand:function(){if(!this.activeHandName){this.activeHandName="hour";this.activeHand=hourHand}return(this.activeHandName)},setActiveHand:function(b){var c="black";var a="black";if(b=="toggle"||b=="hour"||b=="minute"){if(b=="toggle"){if(this.getActiveHand()=="hour"){b="minute"}else{b="hour"}}if(b=="minute"){c="red";this.activeHand=this.minuteHand;this.activeHandName="minute"}else{if(b=="hour"){a="red";this.activeHand=this.hourHand;this.activeHandName="hour"}}$(hourHand)[0].setAttribute("fill",a);$(minuteHand)[0].setAttribute("fill",c);document.getElementById("digitalTimeHours").setAttribute("fill",a);document.getElementById("digitalTimeMinutes").setAttribute("fill",c)}},withinClock:function(c,b){var a=false;dx=c-x[0];dy=b-y[0];if(Math.sqrt(dx*dx+dy*dy)<=this.handLength[this.minuteHand]){a=true}return a},setHand:function(e,c){var g=Math.sqrt(e*e+c*c);var f=this.getAngleFromVector(e,c);f=f+180;var a=this.handLength[this.activeHandName+"Hand"];if(g>a){g=a}var d=f.toString()+" "+x[0]+" "+y[0];var b=this.activeHandName+"Hand";$("#"+b)[0].setAttribute("height",g);$("#"+b)[0].setAttribute("transform","rotate("+d+")")},hideHands:function(){this.hourHand.setAttribute("height","0");this.minuteHand.setAttribute("height","0")},setHourHand:function(a){if(a){this.currentHour=Math.trunc(a)}else{a=this.currentHour}if(this.currentMinutes){a=Math.trunc(a)+this.currentMinutes/80}degrees=(a+6)*30;rotation=degrees.toString()+" "+x[0]+" "+y[0];this.hourHand.setAttribute("transform","rotate("+rotation+")");this.hourHand.setAttribute("height",this.handLength.hourHand)},setMinuteHand:function(a){if(a){this.currentMinutes=a}else{a=this.currentMinutes}degrees=(Math.round(a))*6+180;rotation=degrees.toString()+" "+x[0]+" "+y[0];this.minuteHand.setAttribute("transform","rotate("+rotation+")");this.minuteHand.setAttribute("height",this.handLength.minuteHand)},hideControl:function(){$("#ticPageBackground").hide();$("#"+this.ticId).hide()},showControl:function(){$("#"+this.ticId).show()},returnTime:function(){debug("returnTime");this.hideControl();if(this.clockItem&&this.currentHour&&this.currentMinutes){var a=this.lpad(this.currentHour)+":"+this.lpad(this.currentMinutes);$(clockItem).val(a)}},svgCreateElement:function(a){return document.createElementNS("http://www.w3.org/2000/svg",a)},svgCreateRootElem:function(e,d,a,c){var b=this.svgCreateElement("svg");b.setAttribute("id",e);b.setAttribute("width",d);b.setAttribute("height",a);b.setAttribute("viewBox",c);return(b)},svgCreateGroup:function(b,a){var c=this.svgCreateElement("g");c.setAttribute("id",b);if(a){c.setAttribute("class",a)}return(c)},centerTextElement:function(c,a,b){textObj=document.getElementById(c);length=textObj.getComputedTextLength();xText=a+(b-length)/2;textObj.setAttribute("x",xText)},leftAlignTextElement:function(c,b){textObj=document.getElementById(c);length=textObj.getComputedTextLength();var a=b-length;textObj.setAttribute("x",a);return(b)},svgCreateTextElement:function(b,d,a,e){newText=this.svgCreateElement("text");newText.setAttribute("id",b);newText.setAttribute("x",a);newText.setAttribute("y",e);var c=document.createTextNode(d);newText.appendChild(c);return newText},svgCreateRect:function(f,a,e,c,b,g,h,j,d){$(this.svgCreateElement("rect")).attr("id",a).attr("x",e).attr("y",c).attr("width",b).attr("height",g).attr("stroke-width",d).attr("stroke",j).attr("fill",h).appendTo($(f))},createButton:function(f,c,g,b,h,e,a){var d=this.svgCreateGroup(c,"button");$(this.SVG("rect")).attr("id",c+"Box").attr("x",b).attr("y",h).attr("rx","5").attr("ry","5").attr("width",e).attr("height",a).attr("stroke-width","1").attr("stroke","black").attr("fill","white").appendTo($(d));$(this.SVG("animate")).attr("begin","click").attr("dur","0.5s").attr("repeatCount","1").attr("attributeName","fill").attr("values","white; gray ; white").attr("fill","freeze").appendTo($("#"+c+"Box"));buttonText=this.svgCreateTextElement(c+"Text",g,b,h+a-14);$(buttonText).appendTo($(d));$(d).appendTo($(f));this.centerTextElement(buttonText.id,b,e);return(d)},generateHand:function(b,c){var a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("id",c);a.setAttribute("x",169);a.setAttribute("y",y[0]);a.setAttribute("width","5");a.setAttribute("height",this.handLength[c]);a.setAttribute("rx","3");a.setAttribute("ry","3");a.setAttribute("fill","black");a.setAttribute("stroke-width","0");a.setAttribute("transform","rotate(180 "+x[0]+" "+y[0]+")");handGroup=this.svgCreateGroup(c+"Group");handGroup.appendChild(a);b.appendChild(handGroup);if(c=="hourHand"){this.hourHand=a}else{this.minuteHand=a}},updateDigitalTime:function(a,b){if(a!=null){if(a>=0){document.getElementById("digitalTimeHours").textContent=this.lpad(a);this.leftAlignTextElement("digitalTimeHours",hourTextLeft)}if(b>=0){document.getElementById("digitalTimeMinutes").textContent=this.lpad(b)}}else{document.getElementById("digitalTimeHours").textContent="";document.getElementById("digitalTimeMinutes").textContent=""}},updateAnalogTime:function(a,b){a=parseInt(a);if(this.currentMinutes){a=a+b/80}this.setHourHand(a);if(this.currentMinutes){this.setMinuteHand(b)}},createDigitalTime:function(c,a,b){lGroup=this.svgCreateGroup("ticDigitalTimeGroup");$(lGroup).appendTo($(c));x=95;y=-35;width=148;height=35;this.svgCreateRect(lGroup,"ticDigitalTimeBox",x,y,width,height,"white","black","1");y=y+height-5;xText=x+width/2;text=this.svgCreateTextElement("digitalTimeColon",":",xText,y-5);$(text).appendTo($(lGroup));a=this.lpad(a);xText=x+width/2-5;text=this.svgCreateTextElement("digitalTimeHours",a,xText,y-5);$(text).appendTo($(lGroup));hourTextLeft=this.leftAlignTextElement("digitalTimeHours",xText);b=this.lpad(b);xText=x+width/2+12;text=this.svgCreateTextElement("digitalTimeMinutes",b,xText,y-5);$(text).appendTo($(lGroup));return(lGroup)},setCurrentDigitalTime:function(){this.updateDigitalTime(this.currentHour,this.currentMinutes)},toAM:function(){if(this.currentHour>=12){this.currentHour=this.currentHour-12;this.setCurrentDigitalTime()}this.setMode("AM")},toPM:function(){if(this.currentHour<12){this.currentHour=this.currentHour+12;this.setCurrentDigitalTime()}this.setMode("PM")},setCurrentAnalogTime:function(){this.updateAnalogTime(this.currentHour,this.currentMinutes)},ticSetTime:function(a,b){if(a){this.currentHours=a}if(b){this.currentMinutes=b}this.setCurrentDigitalTime();this.setCurrentAnalogTime()},ticAddTouchEvents:function(b){var a=$("#"+b)[0];a.addEventListener("touchstart",function(d){var c=d.changedTouches[0];startx=parseInt(c.clientX);starty=parseInt(c.clientY);apextic.debug("touchStart: starting position = "+startx+";"+starty);apextic.touchStartInClock=false;if(apextic.withinClock(startx,starty)){d.preventDefault();apextic.touchStartInClock=true}},false);a.addEventListener("touchmove",function(g){var f=g.changedTouches[0];var d=parseInt(f.clientX)-startx;var c=parseInt(f.clientY)-starty;apextic.setHand(d,c);g.preventDefault()},false);a.addEventListener("touchend",function(h){var f=h.changedTouches[0];var d=parseInt(f.clientX)-startx;var c=parseInt(f.clientY)-starty;apextic.debug("touchEnd: directions = "+d+";"+c);apextic.setHand(d,c);if((Math.abs(d)+Math.abs(c))>apextic.sensitivity){var g=apextic.getTime(d,-c);if(apextic.activeHandName=="hour"){apextic.currentHour=g;if(apextic.currentHour<apextic.window_base){apextic.currentHour=apextic.currentHour+12}}else{apextic.currentMinutes=g*5}apextic.ticSetTime();apextic.setActiveHand("toggle")}if(apextic.touchStartInClock){h.preventDefault()}},false)},ticPageBackground:function(){return($("#ticPageBackground"))},ticExists:function(){return($("#ticControl").length>0)},ticCancel:function(){this.hideControl()},ticReturnTime:function(){this.debug("ticReturnTime");this.hideControl();if(this.clockItem){this.currentTime=null;if(this.currentHour>-1&&this.currentMinutes>-1){var a=(this.currentHour>12)?"PM":"AM";var b=(this.currentHour>12)?this.currentHour-12:this.currentHour;if(this.time_format=="hh:mi am"){this.currentTime=this.lpad(b)+":"+this.lpad(this.currentMinutes)+" "+a}if(this.time_format=="hh24.mi"){this.currentTime=this.lpad(this.currentHour)+"."+this.lpad(this.currentMinutes)}if(this.time_format=="hh.mi am"){this.currentTime=this.lpad(b)+"."+this.lpad(this.currentMinutes)+" "+a}if(this.currentTime==null){this.currentTime=this.lpad(this.currentHour)+":"+this.lpad(this.currentMinutes)}this.debug(this.currentTime);$(this.clockItem).val(this.currentTime)}}},buildControl:function(c){$("body").append('<div id="ticPageBackground"></div>');$("body").append('<div id="ticControl"></div>');$("#ticControl").append('<div id="ticBox"></div>');var b=Math.min($(window).width(),500);var a=Math.round(b*650/500);svg=this.svgCreateRootElem("ticClock",b,"650","0 0 350 350");$(svg).appendTo($("#ticBox"));var f=document.createElementNS("http://www.w3.org/2000/svg","g");f.setAttribute("id","ticTime");f.setAttribute("color","black");f.setAttribute("font-family","arial");f.setAttribute("font-size","34");svg.appendChild(f);this.createDigitalTime(f,0,0);$("#ticDigitalTimeGroup").click(function(g){this.setActiveHand("toggle")});buttonAM=this.createButton(f,"buttonAM","AM",10,-35,70,35);$(buttonAM).click(function(){apextic.toAM()});buttonPM=this.createButton(f,"buttonPM","PM",258,-35,70,35);$(buttonPM).click(function(){apextic.toPM()});buttonCancel=this.createButton(f,"buttonCancel","Cancel",10,340,149,35);$(buttonCancel).click(function(){apextic.ticCancel()});buttonOK=this.createButton(f,"buttonOK","OK",178,340,149,35);$(buttonOK).click(function(){apextic.ticReturnTime()});var d=document.createElementNS("http://www.w3.org/2000/svg","g");d.setAttribute("id","ticNumbers");d.setAttribute("color","black");d.setAttribute("font-family","arial");d.setAttribute("font-size","34");svg.appendChild(d);this.ticAddTouchEvents("ticNumbers");x=[171,213,254,267,254,214,162,108,69,55,59,100,152];y=[152,74,113,164,218,255,270,255,218,164,113,74,58];for(i=0;i<=12;i++){y[i]=y[i]+12}newRect=document.createElementNS("http://www.w3.org/2000/svg","rect");newRect.setAttribute("id","ticBackground");newRect.setAttribute("x","10");newRect.setAttribute("y","10");newRect.setAttribute("width","318");newRect.setAttribute("height","314");newRect.setAttribute("rx","65");newRect.setAttribute("ry","65");newRect.setAttribute("fill","black");newRect.setAttribute("stroke-width","0");d.appendChild(newRect);newCircle=document.createElementNS("http://www.w3.org/2000/svg","circle");newCircle.setAttribute("id","center");newCircle.setAttribute("cx",x[0]);newCircle.setAttribute("cy",y[0]);newCircle.setAttribute("r","140");newCircle.setAttribute("fill","white");newCircle.setAttribute("stroke","black");newCircle.setAttribute("stroke-width","5");d.appendChild(newCircle);this.generateHand(d,"hourHand");this.generateHand(d,"minuteHand");newCircle=document.createElementNS("http://www.w3.org/2000/svg","circle");newCircle.setAttribute("id","center");newCircle.setAttribute("cx",x[0]);newCircle.setAttribute("cy",y[0]);newCircle.setAttribute("r","5");newCircle.setAttribute("fill","red");newCircle.setAttribute("stroke","black");newCircle.setAttribute("stroke-width","5");d.appendChild(newCircle);for(i=1;i<=12;i++){newText=document.createElementNS("http://www.w3.org/2000/svg","text");newText.setAttribute("id","txt"+i);newText.setAttribute("x",x[i]);newText.setAttribute("y",y[i]);var e=document.createTextNode(i);newText.appendChild(e);d.appendChild(newText)}$("[id^=txt]").click(function(g){var h=$(this).attr("id").substring(3);if(apextic.getActiveHand()=="hour"){apextic.currentHour=parseInt(h);if(apextic.currentHour==12){apextic.currentHour=0}if(apextic.currentHour<apextic.window_base){apextic.currentHour=apextic.currentHour+12}if(apextic.currentMinutes<0){apextic.currentMinutes=0}if(apextic.mode=="PM"){apextic.currentHour=apextic.currentHour+12}apextic.setHourHand();apextic.setActiveHand("minute")}else{apextic.currentMinutes=parseInt(h)*5;if(apextic.currentMinutes==60){apextic.currentMinutes=0}apextic.setMinuteHand();apextic.setActiveHand("hour")}apextic.setCurrentDigitalTime()})},ticShow:function(a,c,b){this.clockItem=a;this.window_base=c;this.time_format=b;$(this.ticPageBackground()).show();if(this.ticExists()){this.showControl(a)}else{this.buildControl(a)}this.hideHands();this.currentHour=null;this.currentMinutes=null;this.updateDigitalTime(this.currentHour,this.currentMinutes);this.setActiveHand("hour")},doIt:function(){var b;var f=this;var a=f.affectedElements;var e="#"+$(a).attr("id");var d=(f.action.attribute01)?f.action.attribute01:7;var c=(f.action.attribute02)?f.action.attribute02:"hh24:mi";apextic.logging=(f.action.attribute10)?f.action.attribute10:0;apextic.debug("Function: Apex Touch Time Control");apextic.debug("Parameters: item ID     ="+e);apextic.debug("            window_base ="+d);apextic.debug("            time_format ="+c);apextic.ticShow(e,d,c)}};