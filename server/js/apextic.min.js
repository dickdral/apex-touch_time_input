var apextic={x:null,y:null,hourHand:null,minuteHand:null,activeHand:null,handLength:{hourHand:"60",minuteHand:"85"},clockItem:null,ticId:"ticControl",ticBox:document.getElementById("ticBox"),startx:0,starty:0,dist:0,hourTextLeft:0,window_base:7,logging:0,activeHandName:"hour",currentHour:null,currentMinutes:null,sensitivity:20,mode:"base",touchStartInClock:!1,debug:function(t){1==this.logging&&console.log(t)},lpad:function(t){var e="";return null!=t&&(e=t.toString(),1==e.length&&(e="0"+e)),e},getAngleFromVector:function(t,e){var i=0,n=180/Math.PI;return 0==t?i=e>0?180:0:(i=Math.atan(e/Math.abs(t))*n,i=t>0?90+i:270-i),i},setMode:function(t){this.mode=t,"AM"==this.mode?(this.window_base=0,$("#buttonPM text").attr("fill","black"),$("#buttonAM text").attr("fill","lightgray")):(this.window_base=12,$("#buttonPM text").attr("fill","lightgray"),$("#buttonAM text").attr("fill","black"))},SVG:function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},setCurrentTimeFromString:function(t){var e=t.split(":");e.length>=1&&(this.currentHour=parseInt(e[0]),this.currentHour>=12?this.setMode("PM"):this.setMode("AM")),e.length>=2&&(this.currentMinutes=parseInt(e[1]))},getTime:function(t,e){var i,n;return Math.abs(e)>Math.abs(t)?(n=t/e,i=e>0?11:5):(n=-e/t,i=t>0?2:8),n>-.26&&(i+=1),n>.26&&(i+=1),i>=12&&(i-=12),i},getActiveHand:function(){return this.activeHandName||(this.activeHandName="hour",this.activeHand=hourHand),this.activeHandName},setActiveHand:function(t){var e="black",i="black";"toggle"!=t&&"hour"!=t&&"minute"!=t||("toggle"==t&&(t="hour"==this.getActiveHand()?"minute":"hour"),"minute"==t?(e="red",this.activeHand=this.minuteHand,this.activeHandName="minute"):"hour"==t&&(i="red",this.activeHand=this.hourHand,this.activeHandName="hour"),$(hourHand)[0].setAttribute("fill",i),$(minuteHand)[0].setAttribute("fill",e),document.getElementById("digitalTimeHours").setAttribute("fill",i),document.getElementById("digitalTimeMinutes").setAttribute("fill",e))},withinClock:function(t,e){var i=!1;return dx=t-x[0],dy=e-y[0],Math.sqrt(dx*dx+dy*dy)<=this.handLength[this.minuteHand]&&(i=!0),this.debug("Position within clock:"+i),i},setHand:function(t,e){var i=Math.sqrt(t*t+e*e),n=this.getAngleFromVector(t,e);n+=180;var r=this.handLength[this.activeHandName+"Hand"];i>r&&(i=r);var u=n.toString()+" "+x[0]+" "+y[0],a=this.activeHandName+"Hand";$("#"+a)[0].setAttribute("height",i),$("#"+a)[0].setAttribute("transform","rotate("+u+")")},hideHands:function(){this.hourHand.setAttribute("height","0"),this.minuteHand.setAttribute("height","0")},setHourHand:function(t){t?this.currentHour=Math.trunc(t):t=this.currentHour,this.currentMinutes&&(t=Math.trunc(t)+this.currentMinutes/80),degrees=30*(t+6),rotation=degrees.toString()+" "+x[0]+" "+y[0],this.hourHand.setAttribute("transform","rotate("+rotation+")"),this.hourHand.setAttribute("height",this.handLength.hourHand)},setMinuteHand:function(t){t?this.currentMinutes=t:t=this.currentMinutes,degrees=6*Math.round(t)+180,rotation=degrees.toString()+" "+x[0]+" "+y[0],this.minuteHand.setAttribute("transform","rotate("+rotation+")"),this.minuteHand.setAttribute("height",this.handLength.minuteHand)},hideControl:function(){$("#ticPageBackground").hide(),$("#"+this.ticId).hide()},showControl:function(){$("#"+this.ticId).show()},returnTime:function(){if(this.hideControl(),this.clockItem&&this.currentHour&&this.currentMinutes){var t=this.lpad(this.currentHour)+":"+this.lpad(this.currentMinutes);$(clockItem).val(t)}},svgCreateElement:function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},svgCreateRootElem:function(t,e,i,n){var r=this.svgCreateElement("svg");return r.setAttribute("id",t),r.setAttribute("width",e),r.setAttribute("height",i),r.setAttribute("viewBox",n),r},svgCreateGroup:function(t,e){var i=this.svgCreateElement("g");return i.setAttribute("id",t),e&&i.setAttribute("class",e),i},centerTextElement:function(t,e,i){textObj=document.getElementById(t),length=textObj.getComputedTextLength(),xText=e+(i-length)/2,textObj.setAttribute("x",xText)},leftAlignTextElement:function(t,e){textObj=document.getElementById(t),length=textObj.getComputedTextLength();var i=e-length;return textObj.setAttribute("x",i),e},svgCreateTextElement:function(t,e,i,n){newText=this.svgCreateElement("text"),newText.setAttribute("id",t),newText.setAttribute("x",i),newText.setAttribute("y",n);var r=document.createTextNode(e);return newText.appendChild(r),newText},svgCreateRect:function(t,e,i,n,r,u,a,s,o){$(this.svgCreateElement("rect")).attr("id",e).attr("x",i).attr("y",n).attr("width",r).attr("height",u).attr("stroke-width",o).attr("stroke",s).attr("fill",a).appendTo($(t))},createButton:function(t,e,i,n,r,u,a){var s=this.svgCreateGroup(e,"button");return $(this.SVG("rect")).attr("id",e+"Box").attr("x",n).attr("y",r).attr("rx","5").attr("ry","5").attr("width",u).attr("height",a).attr("stroke-width","1").attr("stroke","black").attr("fill","white").appendTo($(s)),$(this.SVG("animate")).attr("begin","click").attr("dur","0.5s").attr("repeatCount","1").attr("attributeName","fill").attr("values","white; gray ; white").attr("fill","freeze").appendTo($("#"+e+"Box")),buttonText=this.svgCreateTextElement(e+"Text",i,n,r+a-14),$(buttonText).appendTo($(s)),$(s).appendTo($(t)),this.centerTextElement(buttonText.id,n,u),s},generateHand:function(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("id",e),i.setAttribute("x",169),i.setAttribute("y",y[0]),i.setAttribute("width","5"),i.setAttribute("height",this.handLength[e]),i.setAttribute("rx","3"),i.setAttribute("ry","3"),i.setAttribute("fill","black"),i.setAttribute("stroke-width","0"),i.setAttribute("transform","rotate(180 "+x[0]+" "+y[0]+")"),handGroup=this.svgCreateGroup(e+"Group"),handGroup.appendChild(i),t.appendChild(handGroup),"hourHand"==e?this.hourHand=i:this.minuteHand=i},updateDigitalTime:function(t,e){null!=t?(t>=0&&(document.getElementById("digitalTimeHours").textContent=this.lpad(t),this.leftAlignTextElement("digitalTimeHours",hourTextLeft)),e>=0&&(document.getElementById("digitalTimeMinutes").textContent=this.lpad(e))):(document.getElementById("digitalTimeHours").textContent="",document.getElementById("digitalTimeMinutes").textContent="")},updateAnalogTime:function(t,e){t=parseInt(t),this.currentMinutes&&(t+=e/80),this.setHourHand(t),this.currentMinutes&&this.setMinuteHand(e)},createDigitalTime:function(t,e,i){return lGroup=this.svgCreateGroup("ticDigitalTimeGroup"),$(lGroup).appendTo($(t)),x=95,y=-35,width=148,height=35,this.svgCreateRect(lGroup,"ticDigitalTimeBox",x,y,width,height,"white","black","1"),y=y+height-5,xText=x+width/2,text=this.svgCreateTextElement("digitalTimeColon",":",xText,y-5),$(text).appendTo($(lGroup)),e=this.lpad(e),xText=x+width/2-5,text=this.svgCreateTextElement("digitalTimeHours",e,xText,y-5),$(text).appendTo($(lGroup)),hourTextLeft=this.leftAlignTextElement("digitalTimeHours",xText),i=this.lpad(i),xText=x+width/2+12,text=this.svgCreateTextElement("digitalTimeMinutes",i,xText,y-5),$(text).appendTo($(lGroup)),lGroup},setCurrentDigitalTime:function(){this.updateDigitalTime(this.currentHour,this.currentMinutes)},toAM:function(){this.currentHour>=12&&(this.currentHour=this.currentHour-12,this.setCurrentDigitalTime()),this.setMode("AM")},toPM:function(){this.currentHour<12&&(this.currentHour=this.currentHour+12,this.setCurrentDigitalTime()),this.setMode("PM")},setCurrentAnalogTime:function(){this.updateAnalogTime(this.currentHour,this.currentMinutes)},ticSetTime:function(t,e){t&&(this.currentHours=t),e&&(this.currentMinutes=e),this.setCurrentDigitalTime(),this.setCurrentAnalogTime()},ticAddTouchEvents:function(t){var e=$("#"+t)[0];e.addEventListener("touchstart",function(t){var e=t.changedTouches[0];startx=parseInt(e.clientX),starty=parseInt(e.clientY),apextic.debug("touchStart:"+startx+";"+starty),apextic.touchStartInClock=!1,apextic.withinClock(startx,starty)&&(t.preventDefault(),apextic.touchStartInClock=!0)},!1),e.addEventListener("touchmove",function(t){var e=t.changedTouches[0],i=parseInt(e.clientX)-startx,n=parseInt(e.clientY)-starty;apextic.setHand(i,n),t.preventDefault()},!1),e.addEventListener("touchend",function(t){var e=t.changedTouches[0],i=parseInt(e.clientX)-startx,n=parseInt(e.clientY)-starty;if(apextic.debug(i+";"+n),apextic.setHand(i,n),Math.abs(i)+Math.abs(n)>apextic.sensitivity){var r=apextic.getTime(i,-n);"hour"==apextic.activeHandName?(apextic.currentHour=r,apextic.currentHour<apextic.window_base&&(apextic.currentHour=apextic.currentHour+12)):apextic.currentMinutes=5*r,apextic.ticSetTime(),apextic.setActiveHand("toggle")}apextic.touchStartInClock&&t.preventDefault()},!1)},ticPageBackground:function(){return $("#ticPageBackground")},ticExists:function(){return $("#ticControl").length>0},ticCancel:function(){this.hideControl()},ticReturnTime:function(){this.hideControl(),this.clockItem&&(this.currentTime="",this.currentHour>-1&&this.currentMinutes>-1&&(this.currentTime=this.lpad(this.currentHour)+":"+this.lpad(this.currentMinutes),$(this.clockItem).val(this.currentTime)))},buildControl:function(){$("body").append('<div id="ticPageBackground"></div>'),$("body").append('<div id="ticControl"></div>'),$("#ticControl").append('<div id="ticBox"></div>');var t=Math.min($(window).width(),500);svg=this.svgCreateRootElem("ticClock",t,"500","0 0 350 350"),$(svg).appendTo($("#ticBox"));var e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttribute("id","ticTime"),e.setAttribute("color","black"),e.setAttribute("font-family","arial"),e.setAttribute("font-size","34"),svg.appendChild(e),this.createDigitalTime(e,0,0),$("#ticDigitalTimeGroup").click(function(){this.setActiveHand("toggle")}),buttonAM=this.createButton(e,"buttonAM","AM",10,-35,70,35),$(buttonAM).click(function(){apextic.toAM()}),buttonPM=this.createButton(e,"buttonPM","PM",258,-35,70,35),$(buttonPM).click(function(){apextic.toPM()}),buttonCancel=this.createButton(e,"buttonCancel","Cancel",10,340,149,35),$(buttonCancel).click(function(){apextic.ticCancel()}),buttonOK=this.createButton(e,"buttonOK","OK",178,340,149,35),$(buttonOK).click(function(){apextic.ticReturnTime()});var n=document.createElementNS("http://www.w3.org/2000/svg","g");for(n.setAttribute("id","ticNumbers"),n.setAttribute("color","black"),n.setAttribute("font-family","arial"),n.setAttribute("font-size","34"),svg.appendChild(n),this.ticAddTouchEvents("ticNumbers"),x=[171,213,254,267,254,214,162,108,69,55,59,100,152],y=[152,74,113,164,218,255,270,255,218,164,113,74,58],i=0;i<=12;i++)y[i]=y[i]+12;for(newRect=document.createElementNS("http://www.w3.org/2000/svg","rect"),newRect.setAttribute("id","ticBackground"),newRect.setAttribute("x","10"),newRect.setAttribute("y","10"),newRect.setAttribute("width","318"),newRect.setAttribute("height","314"),newRect.setAttribute("rx","65"),newRect.setAttribute("ry","65"),newRect.setAttribute("fill","black"),newRect.setAttribute("stroke-width","0"),n.appendChild(newRect),newCircle=document.createElementNS("http://www.w3.org/2000/svg","circle"),newCircle.setAttribute("id","center"),newCircle.setAttribute("cx",x[0]),newCircle.setAttribute("cy",y[0]),newCircle.setAttribute("r","140"),newCircle.setAttribute("fill","white"),newCircle.setAttribute("stroke","black"),newCircle.setAttribute("stroke-width","5"),n.appendChild(newCircle),this.generateHand(n,"hourHand"),this.generateHand(n,"minuteHand"),newCircle=document.createElementNS("http://www.w3.org/2000/svg","circle"),newCircle.setAttribute("id","center"),newCircle.setAttribute("cx",x[0]),newCircle.setAttribute("cy",y[0]),newCircle.setAttribute("r","5"),newCircle.setAttribute("fill","red"),newCircle.setAttribute("stroke","black"),newCircle.setAttribute("stroke-width","5"),n.appendChild(newCircle),i=1;i<=12;i++){newText=document.createElementNS("http://www.w3.org/2000/svg","text"),newText.setAttribute("id","txt"+i),newText.setAttribute("x",x[i]),newText.setAttribute("y",y[i]);var r=document.createTextNode(i);newText.appendChild(r),n.appendChild(newText)}$("[id^=txt]").click(function(){var t=$(this).attr("id").substring(3);"hour"==this.getActiveHand()?(this.currentHour=parseInt(t),12==this.currentHour&&(this.currentHour=0),this.currentMinutes<0&&(this.currentMinutes=0),"PM"==this.mode&&(this.currentHour=this.currentHour+12),this.setHourHand(),this.setActiveHand("minute")):(this.currentMinutes=5*parseInt(t),60==this.currentMinutes&&(this.currentMinutes=0),this.setMinuteHand(),this.setActiveHand("hour")),this.setCurrentDigitalTime()})},ticShow:function(t,e){this.clockItem=t,this.window_base=e,$(this.ticPageBackground()).show(),this.ticExists()?this.showControl(t):this.buildControl(t),this.hideHands(),this.currentHour=null,this.currentMinutes=null,this.updateDigitalTime(this.currentHour,this.currentMinutes),this.setActiveHand("hour")},doIt:function(){var t=this,e=t.affectedElements,i="#"+$(e).attr("id"),n=t.action.attribute01?t.action.attribute01:7;apextic.logging=t.action.attribute02?t.action.attribute02:0,apextic.debug("Function: Apex Touch Time Control"),apextic.debug("Parameters: item ID     ="+i),apextic.debug("            window_base ="+n),apextic.ticShow(i,n)}};